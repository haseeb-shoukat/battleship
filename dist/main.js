(()=>{"use strict";const e=function(e){return{info:e,coords:e.coords,hit:[],processHit:function(e){this.hit.push(e)},isSunk:function(){return this.hit.length===this.coords.length},contains:function(e,t){return this[t].some((t=>JSON.stringify(t)===JSON.stringify(e)))}}};class t{constructor(t="player"){this.myBoard=function(){let t=[],s=[];for(let e=0;e<10;e++)for(let r=0;r<10;r++)t.push([e,r]),s.push([e,r]);return{ships:[],missed:[],types:[{type:"Carrier",len:5},{type:"Battleship",len:4},{type:"Destroyer",len:3},{type:"Submarine",len:3},{type:"Patrol Boat",len:2}],legalPlacements:s,legalMoves:t,automaticShips:function(){this.types.forEach((t=>{const s=["x","y"][Math.floor(2*Math.random())];let r=[];for(;!this.canPlaceShip(r);){r=[];let[e,i]=this.legalPlacements[Math.floor(Math.random()*this.legalPlacements.length)];if("x"===s)for(let s=i;s<i+t.len;s++)r.push([e,s]);else for(let s=e;s<e+t.len;s++)r.push([s,i])}let i={coords:r,axis:s};this.ships.push(e(i)),this.updateLegalPlacements(i)}))},placeShip:function(t){this.ships.push(e(t)),this.updateLegalPlacements(t)},canPlaceShip:function(e){return!(e.length<2)&&e.every((e=>this.legalPlacements.some((t=>JSON.stringify(e)===JSON.stringify(t)))))},updateLegalPlacements:function(e){let t=JSON.parse(JSON.stringify(e.coords)),[s,r]=e.coords[0],[i,n]=e.coords[e.coords.length-1];"y"===e.axis?(t.push([s-1,r],[i+1,n]),t.forEach((([e,s])=>{t.push([e,s-1],[e,s+1])})),e.coords.forEach((([e,s])=>{t.push([e,s-1],[e,s+1])}))):(t.push([s,r-1],[i,n+1]),t.forEach((([e,s])=>{t.push([e-1,s],[e+1,s])})),e.coords.forEach((([e,s])=>{t.push([e-1,s],[e+1,s])})));let o=this.legalPlacements.filter((e=>t.every((t=>JSON.stringify(e)!==JSON.stringify(t)))));this.legalPlacements=o},receiveAttack:function(e,t){let s=!1;return this.ships.every((r=>!r.contains([e,t],"coords")||(r.processHit([e,t]),s=!0,!1))),!1===s&&this.missed.push([e,t]),this.updateLegal(e,t),s},allSunk:function(){return this.ships.every((e=>e.isSunk()))},updateLegal:function(e,t){let s=this.legalMoves.filter((s=>JSON.stringify(s)!==JSON.stringify([e,t])));this.legalMoves=s},isIllegal:function(e,t){return this.legalMoves.every((s=>JSON.stringify(s)!==JSON.stringify([e,t])))}}}(),this.enemy,this.id=t,this.currentTurn=!1}setEnemy(e){this.enemy=e}setCurrent(e){this.currentTurn=e}attack(e,t){return this.enemy.receive(e,t)}compShips(){"comp"===this.id&&this.myBoard.automaticShips()}compAttack(){if("comp"!==this.id)return;let e=this.enemy.myBoard.legalMoves,[t,s]=e[Math.floor(Math.random()*e.length)];return this.enemy.receive(t,s)}receive(e,t){if(this.myBoard.isIllegal(e,t))return"Illegal Move";!0!==this.myBoard.receiveAttack(e,t)&&(this.currentTurn=!0,this.enemy.setCurrent(!1))}}const s=function(){const e=document.querySelector(".board-one"),t=document.querySelector(".board-two");for(let s=0;s<10;s++)for(let r=0;r<10;r++){const i=document.createElement("div");i.classList.add("board-item"),i.dataset.coord=[s,r].join(""),e.appendChild(i),t.appendChild(i.cloneNode())}const s=function(e){let t;t="player"===e.id?"one":"two",e.myBoard.missed.forEach((e=>{document.querySelector(`.board-${t} > [data-coord="${e.join("")}"]`).classList.add("missed")})),e.myBoard.ships.forEach((e=>{e.hit.forEach((e=>{document.querySelector(`.board-${t} > [data-coord="${e.join("")}"]`).classList.add("hit")}))}))};return{render:function(e,t){s(e),s(t)}}}();(function(){const e=new t,r=new t("comp"),i=function(){s.render(e,r),!0!==e.currentTurn?n():r.myBoard.legalMoves.forEach((e=>{document.querySelector(`.board-two > [data-coord="${e.join("")}"]`).addEventListener("click",n)}))},n=function(t="null"){if(!0===e.currentTurn){let[s,r]=t.target.dataset.coord.split("").map(Number);e.attack(s,r)}else r.compAttack();i()};return{initialize:function(){e.setEnemy(r),r.setEnemy(e),e.setCurrent(!0),r.compShips(),console.log(r.myBoard.ships),i()}}})().initialize()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxFQUFHQyxFQUNuQixNQUNFMkQsRUFBU25CLGFBRVhvQixHQUNGLEVBSUEsTUFBTyxDQUNMUyxXQXpDaUIsV0FDakJuQyxFQUFPRCxTQUFTMEIsR0FDaEJBLEVBQVMxQixTQUFTQyxHQUNsQkEsRUFBT0MsWUFBVyxHQU1sQndCLEVBQVNwQixZQUNUK0IsUUFBUUMsSUFBSVosRUFBUy9ELFFBQVFLLE9BTDdCMkQsR0FDRixFQXFDRCxFQS9DZSxHQ0RSUyxZIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL1NoaXAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL1BsYXllci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvR2FtZUJvYXJkLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9yZW5kZXJHYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9ydW5HYW1lLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2hpcCA9IGZ1bmN0aW9uIChpbmZvKSB7XG4gIHJldHVybiB7XG4gICAgaW5mbyxcbiAgICBjb29yZHM6IGluZm8uY29vcmRzLFxuICAgIGhpdDogW10sXG4gICAgcHJvY2Vzc0hpdDogZnVuY3Rpb24gKGNvb3JkKSB7XG4gICAgICB0aGlzLmhpdC5wdXNoKGNvb3JkKTtcbiAgICB9LFxuICAgIGlzU3VuazogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuaGl0Lmxlbmd0aCA9PT0gdGhpcy5jb29yZHMubGVuZ3RoID8gdHJ1ZSA6IGZhbHNlO1xuICAgIH0sXG4gICAgY29udGFpbnM6IGZ1bmN0aW9uIChjb29yZCwgb2JqKSB7XG4gICAgICByZXR1cm4gdGhpc1tvYmpdLnNvbWUoXG4gICAgICAgIChpdGVtKSA9PiBKU09OLnN0cmluZ2lmeShpdGVtKSA9PT0gSlNPTi5zdHJpbmdpZnkoY29vcmQpXG4gICAgICApO1xuICAgIH0sXG4gIH07XG59O1xuXG5leHBvcnQgeyBTaGlwIH07XG4iLCJpbXBvcnQgeyBHYW1lQm9hcmQgfSBmcm9tIFwiLi9HYW1lQm9hcmRcIjtcblxuY2xhc3MgUGxheWVyIHtcbiAgY29uc3RydWN0b3IoaWQgPSBcInBsYXllclwiKSB7XG4gICAgdGhpcy5teUJvYXJkID0gR2FtZUJvYXJkKCk7XG4gICAgdGhpcy5lbmVteTtcbiAgICB0aGlzLmlkID0gaWQ7XG4gICAgdGhpcy5jdXJyZW50VHVybiA9IGZhbHNlO1xuICB9XG5cbiAgc2V0RW5lbXkocGxheWVyKSB7XG4gICAgdGhpcy5lbmVteSA9IHBsYXllcjtcbiAgfVxuXG4gIHNldEN1cnJlbnQodHVybikge1xuICAgIHRoaXMuY3VycmVudFR1cm4gPSB0dXJuO1xuICB9XG5cbiAgYXR0YWNrKHgsIHkpIHtcbiAgICByZXR1cm4gdGhpcy5lbmVteS5yZWNlaXZlKHgsIHkpO1xuICB9XG5cbiAgY29tcFNoaXBzKCkge1xuICAgIGlmICh0aGlzLmlkICE9PSBcImNvbXBcIikgcmV0dXJuO1xuICAgIHRoaXMubXlCb2FyZC5hdXRvbWF0aWNTaGlwcygpO1xuICB9XG5cbiAgY29tcEF0dGFjaygpIHtcbiAgICBpZiAodGhpcy5pZCAhPT0gXCJjb21wXCIpIHJldHVybjtcbiAgICBsZXQgbGVnYWxNb3ZlcyA9IHRoaXMuZW5lbXkubXlCb2FyZC5sZWdhbE1vdmVzO1xuICAgIGxldCBbeCwgeV0gPSBsZWdhbE1vdmVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGxlZ2FsTW92ZXMubGVuZ3RoKV07XG4gICAgcmV0dXJuIHRoaXMuZW5lbXkucmVjZWl2ZSh4LCB5KTtcbiAgfVxuXG4gIHJlY2VpdmUoeCwgeSkge1xuICAgIGlmICh0aGlzLm15Qm9hcmQuaXNJbGxlZ2FsKHgsIHkpKSByZXR1cm4gXCJJbGxlZ2FsIE1vdmVcIjtcbiAgICBsZXQgaGl0ID0gdGhpcy5teUJvYXJkLnJlY2VpdmVBdHRhY2soeCwgeSk7XG4gICAgaWYgKGhpdCAhPT0gdHJ1ZSkge1xuICAgICAgdGhpcy5jdXJyZW50VHVybiA9IHRydWU7XG4gICAgICB0aGlzLmVuZW15LnNldEN1cnJlbnQoZmFsc2UpO1xuICAgIH1cbiAgICByZXR1cm4gXG4gIH1cbn1cblxuZXhwb3J0IHsgUGxheWVyIH07XG4iLCJpbXBvcnQgeyBTaGlwIH0gZnJvbSBcIi4vU2hpcFwiO1xuXG5jb25zdCBHYW1lQm9hcmQgPSBmdW5jdGlvbiAoKSB7XG4gIGxldCBsZWdhbE1vdmVzID0gW107XG4gIGxldCBsZWdhbFBsYWNlbWVudHMgPSBbXTtcbiAgZm9yIChsZXQgeCA9IDA7IHggPCAxMDsgeCsrKSB7XG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCAxMDsgeSsrKSB7XG4gICAgICBsZWdhbE1vdmVzLnB1c2goW3gsIHldKTtcbiAgICAgIGxlZ2FsUGxhY2VtZW50cy5wdXNoKFt4LCB5XSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBzaGlwczogW10sXG4gICAgbWlzc2VkOiBbXSxcbiAgICB0eXBlczogW1xuICAgICAgeyB0eXBlOiBcIkNhcnJpZXJcIiwgbGVuOiA1IH0sXG4gICAgICB7IHR5cGU6IFwiQmF0dGxlc2hpcFwiLCBsZW46IDQgfSxcbiAgICAgIHsgdHlwZTogXCJEZXN0cm95ZXJcIiwgbGVuOiAzIH0sXG4gICAgICB7IHR5cGU6IFwiU3VibWFyaW5lXCIsIGxlbjogMyB9LFxuICAgICAgeyB0eXBlOiBcIlBhdHJvbCBCb2F0XCIsIGxlbjogMiB9LFxuICAgIF0sXG4gICAgbGVnYWxQbGFjZW1lbnRzLFxuICAgIGxlZ2FsTW92ZXMsXG5cbiAgICBhdXRvbWF0aWNTaGlwczogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy50eXBlcy5mb3JFYWNoKCh0eXBlKSA9PiB7XG4gICAgICAgIGNvbnN0IGF4aXMgPSBbXCJ4XCIsIFwieVwiXVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKV07XG4gICAgICAgIGxldCBjb29yZHMgPSBbXTtcbiAgICAgICAgd2hpbGUgKCF0aGlzLmNhblBsYWNlU2hpcChjb29yZHMpKSB7XG4gICAgICAgICAgY29vcmRzID0gW107XG4gICAgICAgICAgbGV0IFt4LCB5XSA9XG4gICAgICAgICAgICB0aGlzLmxlZ2FsUGxhY2VtZW50c1tcbiAgICAgICAgICAgICAgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5sZWdhbFBsYWNlbWVudHMubGVuZ3RoKVxuICAgICAgICAgICAgXTtcbiAgICAgICAgICBpZiAoYXhpcyA9PT0gXCJ4XCIpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSB5OyBpIDwgeSArIHR5cGUubGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgY29vcmRzLnB1c2goW3gsIGldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IHg7IGkgPCB4ICsgdHlwZS5sZW47IGkrKykge1xuICAgICAgICAgICAgICBjb29yZHMucHVzaChbaSwgeV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsZXQgaW5mbyA9IHtcbiAgICAgICAgICBjb29yZHMsXG4gICAgICAgICAgYXhpcyxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zaGlwcy5wdXNoKFNoaXAoaW5mbykpO1xuICAgICAgICB0aGlzLnVwZGF0ZUxlZ2FsUGxhY2VtZW50cyhpbmZvKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBwbGFjZVNoaXA6IGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICB0aGlzLnNoaXBzLnB1c2goU2hpcChpbmZvKSk7XG4gICAgICB0aGlzLnVwZGF0ZUxlZ2FsUGxhY2VtZW50cyhpbmZvKTtcbiAgICB9LFxuXG4gICAgY2FuUGxhY2VTaGlwOiBmdW5jdGlvbiAoY29vcmRzKSB7XG4gICAgICBpZiAoY29vcmRzLmxlbmd0aCA8IDIpIHJldHVybiBmYWxzZTtcbiAgICAgIHJldHVybiBjb29yZHMuZXZlcnkoKGNvb3JkKSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmxlZ2FsUGxhY2VtZW50cy5zb21lKChsZWdhbFBsYWNlKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KGNvb3JkKSA9PT0gSlNPTi5zdHJpbmdpZnkobGVnYWxQbGFjZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZUxlZ2FsUGxhY2VtZW50czogZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgIGxldCBsaXN0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShpbmZvLmNvb3JkcykpO1xuICAgICAgbGV0IFthLCBiXSA9IGluZm8uY29vcmRzWzBdO1xuICAgICAgbGV0IFt5LCB6XSA9IGluZm8uY29vcmRzW2luZm8uY29vcmRzLmxlbmd0aCAtIDFdO1xuXG4gICAgICBpZiAoaW5mby5heGlzID09PSBcInlcIikge1xuICAgICAgICBsaXN0LnB1c2goW2EgLSAxLCBiXSwgW3kgKyAxLCB6XSk7XG4gICAgICAgIGxpc3QuZm9yRWFjaCgoW3gsIHldKSA9PiB7XG4gICAgICAgICAgbGlzdC5wdXNoKFt4LCB5IC0gMV0sIFt4LCB5ICsgMV0pO1xuICAgICAgICB9KTtcbiAgICAgICAgaW5mby5jb29yZHMuZm9yRWFjaCgoW3gsIHldKSA9PiB7XG4gICAgICAgICAgbGlzdC5wdXNoKFt4LCB5IC0gMV0sIFt4LCB5ICsgMV0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxpc3QucHVzaChbYSwgYiAtIDFdLCBbeSwgeiArIDFdKTtcbiAgICAgICAgbGlzdC5mb3JFYWNoKChbeCwgeV0pID0+IHtcbiAgICAgICAgICBsaXN0LnB1c2goW3ggLSAxLCB5XSwgW3ggKyAxLCB5XSk7XG4gICAgICAgIH0pO1xuICAgICAgICBpbmZvLmNvb3Jkcy5mb3JFYWNoKChbeCwgeV0pID0+IHtcbiAgICAgICAgICBsaXN0LnB1c2goW3ggLSAxLCB5XSwgW3ggKyAxLCB5XSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBsZXQgYXJyID0gdGhpcy5sZWdhbFBsYWNlbWVudHMuZmlsdGVyKChjb29yZCkgPT4ge1xuICAgICAgICByZXR1cm4gbGlzdC5ldmVyeShcbiAgICAgICAgICAoaXRlbSkgPT4gSlNPTi5zdHJpbmdpZnkoY29vcmQpICE9PSBKU09OLnN0cmluZ2lmeShpdGVtKVxuICAgICAgICApO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMubGVnYWxQbGFjZW1lbnRzID0gYXJyO1xuICAgIH0sXG5cbiAgICByZWNlaXZlQXR0YWNrOiBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgbGV0IGhpdCA9IGZhbHNlO1xuICAgICAgdGhpcy5zaGlwcy5ldmVyeSgoc2hpcCkgPT4ge1xuICAgICAgICBpZiAoc2hpcC5jb250YWlucyhbeCwgeV0sIFwiY29vcmRzXCIpKSB7XG4gICAgICAgICAgc2hpcC5wcm9jZXNzSGl0KFt4LCB5XSk7XG4gICAgICAgICAgaGl0ID0gdHJ1ZTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9KTtcblxuICAgICAgaWYgKGhpdCA9PT0gZmFsc2UpIHRoaXMubWlzc2VkLnB1c2goW3gsIHldKTtcbiAgICAgIHRoaXMudXBkYXRlTGVnYWwoeCwgeSk7XG4gICAgICByZXR1cm4gaGl0O1xuICAgIH0sXG5cbiAgICBhbGxTdW5rOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5zaGlwcy5ldmVyeSgoc2hpcCkgPT4ge1xuICAgICAgICByZXR1cm4gc2hpcC5pc1N1bmsoKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICB1cGRhdGVMZWdhbDogZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgIGxldCBhcnIgPSB0aGlzLmxlZ2FsTW92ZXMuZmlsdGVyKFxuICAgICAgICAoY29vcmQpID0+IEpTT04uc3RyaW5naWZ5KGNvb3JkKSAhPT0gSlNPTi5zdHJpbmdpZnkoW3gsIHldKVxuICAgICAgKTtcblxuICAgICAgdGhpcy5sZWdhbE1vdmVzID0gYXJyO1xuICAgIH0sXG5cbiAgICBpc0lsbGVnYWw6IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICByZXR1cm4gdGhpcy5sZWdhbE1vdmVzLmV2ZXJ5KChjb29yZCkgPT4ge1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoY29vcmQpICE9PSBKU09OLnN0cmluZ2lmeShbeCwgeV0pO1xuICAgICAgfSk7XG4gICAgfSxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IEdhbWVCb2FyZCB9O1xuIiwiY29uc3QgcmVuZGVyR2FtZSA9IChmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IGJvYXJkT25lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5ib2FyZC1vbmVcIik7XG4gIGNvbnN0IGJvYXJkVHdvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5ib2FyZC10d29cIik7XG5cbiAgZm9yIChsZXQgeCA9IDA7IHggPCAxMDsgeCsrKSB7XG4gICAgZm9yIChsZXQgeSA9IDA7IHkgPCAxMDsgeSsrKSB7XG4gICAgICBjb25zdCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZChcImJvYXJkLWl0ZW1cIik7XG4gICAgICBpdGVtLmRhdGFzZXQuY29vcmQgPSBbeCwgeV0uam9pbihcIlwiKTtcbiAgICAgIGJvYXJkT25lLmFwcGVuZENoaWxkKGl0ZW0pO1xuICAgICAgYm9hcmRUd28uYXBwZW5kQ2hpbGQoaXRlbS5jbG9uZU5vZGUoKSk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgcmVuZGVyID0gZnVuY3Rpb24gKHAxLCBwMikge1xuICAgIHJlbmRlclBsYXllcihwMSk7XG4gICAgcmVuZGVyUGxheWVyKHAyKTtcbiAgfTtcblxuICBjb25zdCByZW5kZXJQbGF5ZXIgPSBmdW5jdGlvbiAocGxheWVyKSB7XG4gICAgbGV0IG51bTtcbiAgICBpZiAocGxheWVyLmlkID09PSBcInBsYXllclwiKSB7XG4gICAgICBudW0gPSBcIm9uZVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBudW0gPSBcInR3b1wiO1xuICAgIH1cblxuICAgIHBsYXllci5teUJvYXJkLm1pc3NlZC5mb3JFYWNoKChtaXNzKSA9PiB7XG4gICAgICBkb2N1bWVudFxuICAgICAgICAucXVlcnlTZWxlY3RvcihgLmJvYXJkLSR7bnVtfSA+IFtkYXRhLWNvb3JkPVwiJHttaXNzLmpvaW4oXCJcIil9XCJdYClcbiAgICAgICAgLmNsYXNzTGlzdC5hZGQoXCJtaXNzZWRcIik7XG4gICAgfSk7XG5cbiAgICBwbGF5ZXIubXlCb2FyZC5zaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgICBzaGlwLmhpdC5mb3JFYWNoKChoaXQpID0+IHtcbiAgICAgICAgZG9jdW1lbnRcbiAgICAgICAgICAucXVlcnlTZWxlY3RvcihgLmJvYXJkLSR7bnVtfSA+IFtkYXRhLWNvb3JkPVwiJHtoaXQuam9pbihcIlwiKX1cIl1gKVxuICAgICAgICAgIC5jbGFzc0xpc3QuYWRkKFwiaGl0XCIpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICByZW5kZXIsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgeyByZW5kZXJHYW1lIH07XG4iLCJpbXBvcnQgeyBQbGF5ZXIgfSBmcm9tIFwiLi9QbGF5ZXJcIjtcbmltcG9ydCB7IHJlbmRlckdhbWUgfSBmcm9tIFwiLi9yZW5kZXJHYW1lXCI7XG5cbmNvbnN0IHJ1bkdhbWUgPSAoZnVuY3Rpb24gKCkge1xuICBjb25zdCBwbGF5ZXIgPSBuZXcgUGxheWVyKCk7XG4gIGNvbnN0IGNvbXB1dGVyID0gbmV3IFBsYXllcihcImNvbXBcIik7XG5cbiAgY29uc3QgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICBwbGF5ZXIuc2V0RW5lbXkoY29tcHV0ZXIpO1xuICAgIGNvbXB1dGVyLnNldEVuZW15KHBsYXllcik7XG4gICAgcGxheWVyLnNldEN1cnJlbnQodHJ1ZSk7XG4gICAgcGxhY2VTaGlwcygpO1xuICAgIGdhbWVMb29wKCk7XG4gIH07XG5cbiAgY29uc3QgcGxhY2VTaGlwcyA9IGZ1bmN0aW9uKCkge1xuICAgIGNvbXB1dGVyLmNvbXBTaGlwcygpO1xuICAgIGNvbnNvbGUubG9nKGNvbXB1dGVyLm15Qm9hcmQuc2hpcHMpXG4gIH07XG5cbiAgY29uc3QgZ2FtZUxvb3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmVuZGVyR2FtZS5yZW5kZXIocGxheWVyLCBjb21wdXRlcik7XG5cbiAgICBpZiAocGxheWVyLmN1cnJlbnRUdXJuID09PSB0cnVlKSB7XG4gICAgICBjb21wdXRlci5teUJvYXJkLmxlZ2FsTW92ZXMuZm9yRWFjaCgobGVnYWxNb3ZlKSA9PiB7XG4gICAgICAgIGRvY3VtZW50XG4gICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoYC5ib2FyZC10d28gPiBbZGF0YS1jb29yZD1cIiR7bGVnYWxNb3ZlLmpvaW4oXCJcIil9XCJdYClcbiAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHByb2Nlc3NDbGljayk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBwcm9jZXNzQ2xpY2soKTtcbiAgfTtcblxuICBjb25zdCBwcm9jZXNzQ2xpY2sgPSBmdW5jdGlvbiAoZSA9IFwibnVsbFwiKSB7XG4gICAgaWYgKHBsYXllci5jdXJyZW50VHVybiA9PT0gdHJ1ZSkge1xuICAgICAgbGV0IFt4LCB5XSA9IGUudGFyZ2V0LmRhdGFzZXQuY29vcmQuc3BsaXQoXCJcIikubWFwKE51bWJlcik7XG4gICAgICBwbGF5ZXIuYXR0YWNrKHgsIHkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb21wdXRlci5jb21wQXR0YWNrKCk7XG4gICAgfVxuICAgIGdhbWVMb29wKCk7XG4gIH07XG5cbiAgY29uc3QgZW5kR2FtZSA9IGZ1bmN0aW9uICgpIHt9O1xuXG4gIHJldHVybiB7XG4gICAgaW5pdGlhbGl6ZSxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCB7IHJ1bkdhbWUgfTtcbiIsImltcG9ydCB7IHJ1bkdhbWUgfSBmcm9tIFwiLi9tb2R1bGVzL3J1bkdhbWVcIjtcblxucnVuR2FtZS5pbml0aWFsaXplKCk7Il0sIm5hbWVzIjpbIlNoaXAiLCJpbmZvIiwiY29vcmRzIiwiaGl0IiwicHJvY2Vzc0hpdCIsImNvb3JkIiwidGhpcyIsInB1c2giLCJpc1N1bmsiLCJsZW5ndGgiLCJjb250YWlucyIsIm9iaiIsInNvbWUiLCJpdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsIlBsYXllciIsImNvbnN0cnVjdG9yIiwiaWQiLCJteUJvYXJkIiwibGVnYWxNb3ZlcyIsImxlZ2FsUGxhY2VtZW50cyIsIngiLCJ5Iiwic2hpcHMiLCJtaXNzZWQiLCJ0eXBlcyIsInR5cGUiLCJsZW4iLCJhdXRvbWF0aWNTaGlwcyIsImZvckVhY2giLCJheGlzIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiY2FuUGxhY2VTaGlwIiwiaSIsInVwZGF0ZUxlZ2FsUGxhY2VtZW50cyIsInBsYWNlU2hpcCIsImV2ZXJ5IiwibGVnYWxQbGFjZSIsImxpc3QiLCJwYXJzZSIsImEiLCJiIiwieiIsImFyciIsImZpbHRlciIsInJlY2VpdmVBdHRhY2siLCJzaGlwIiwidXBkYXRlTGVnYWwiLCJhbGxTdW5rIiwiaXNJbGxlZ2FsIiwiR2FtZUJvYXJkIiwiZW5lbXkiLCJjdXJyZW50VHVybiIsInNldEVuZW15IiwicGxheWVyIiwic2V0Q3VycmVudCIsInR1cm4iLCJhdHRhY2siLCJyZWNlaXZlIiwiY29tcFNoaXBzIiwiY29tcEF0dGFjayIsInJlbmRlckdhbWUiLCJib2FyZE9uZSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImJvYXJkVHdvIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImRhdGFzZXQiLCJqb2luIiwiYXBwZW5kQ2hpbGQiLCJjbG9uZU5vZGUiLCJyZW5kZXJQbGF5ZXIiLCJudW0iLCJtaXNzIiwicmVuZGVyIiwicDEiLCJwMiIsImNvbXB1dGVyIiwiZ2FtZUxvb3AiLCJwcm9jZXNzQ2xpY2siLCJsZWdhbE1vdmUiLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInRhcmdldCIsInNwbGl0IiwibWFwIiwiTnVtYmVyIiwiaW5pdGlhbGl6ZSIsImNvbnNvbGUiLCJsb2ciXSwic291cmNlUm9vdCI6IiJ9