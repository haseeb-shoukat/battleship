(()=>{"use strict";const e=function(e){return{info:e,coords:e.coords,hit:[],processHit:function(e){this.hit.push(e)},isSunk:function(){return this.hit.length===this.coords.length},contains:function(e,t){return this[t].some((t=>JSON.stringify(t)===JSON.stringify(e)))}}};class t{constructor(t="player"){this.myBoard=function(){let t=[],o=[];for(let e=0;e<10;e++)for(let r=0;r<10;r++)t.push([e,r]),o.push([e,r]);return{ships:[],missed:[],types:[{type:"Carrier",len:5},{type:"Battleship",len:4},{type:"Destroyer",len:3},{type:"Submarine",len:3},{type:"Patrol Boat",len:2}],legalPlacements:o,legalMoves:t,automaticShips:function(){this.types.forEach((t=>{const o=["x","y"][Math.floor(2*Math.random())];let r=[];for(;!this.canPlaceShip(r);){r=[];let[e,n]=this.legalPlacements[Math.floor(Math.random()*this.legalPlacements.length)];if("x"===o)for(let o=n;o<n+t.len;o++)r.push([e,o]);else for(let o=e;o<e+t.len;o++)r.push([o,n])}let n={coords:r,axis:o};this.ships.push(e(n)),this.updateLegalPlacements(n)}))},placeShip:function(t){this.ships.push(e(t)),this.updateLegalPlacements(t)},canPlaceShip:function(e){return!(e.length<2)&&e.every((e=>this.legalPlacements.some((t=>JSON.stringify(e)===JSON.stringify(t)))))},updateLegalPlacements:function(e){let t=JSON.parse(JSON.stringify(e.coords)),[o,r]=e.coords[0],[n,s]=e.coords[e.coords.length-1];"y"===e.axis?(t.push([o-1,r],[n+1,s]),t.forEach((([e,o])=>{t.push([e,o-1],[e,o+1])})),e.coords.forEach((([e,o])=>{t.push([e,o-1],[e,o+1])}))):(t.push([o,r-1],[n,s+1]),t.forEach((([e,o])=>{t.push([e-1,o],[e+1,o])})),e.coords.forEach((([e,o])=>{t.push([e-1,o],[e+1,o])})));let i=this.legalPlacements.filter((e=>t.every((t=>JSON.stringify(e)!==JSON.stringify(t)))));this.legalPlacements=i},receiveAttack:function(e,t){let o=!1;return this.ships.every((r=>!r.contains([e,t],"coords")||(r.processHit([e,t]),o=!0,!1))),!1===o&&this.missed.push([e,t]),this.updateLegal(e,t),o},allSunk:function(){return this.ships.every((e=>e.isSunk()))},updateLegal:function(e,t){let o=this.legalMoves.filter((o=>JSON.stringify(o)!==JSON.stringify([e,t])));this.legalMoves=o},isIllegal:function(e,t){return this.legalMoves.every((o=>JSON.stringify(o)!==JSON.stringify([e,t])))}}}(),this.enemy,this.id=t,this.currentTurn=!1}setEnemy(e){this.enemy=e}setCurrent(e){this.currentTurn=e}attack(e,t){return this.enemy.receive(e,t)}compShips(){"comp"===this.id&&this.myBoard.automaticShips()}compAttack(){if("comp"!==this.id)return;let e=this.enemy.myBoard.legalMoves,[t,o]=e[Math.floor(Math.random()*e.length)];return this.enemy.receive(t,o)}receive(e,t){if(this.myBoard.isIllegal(e,t))return"Illegal Move";!0!==this.myBoard.receiveAttack(e,t)&&(this.currentTurn=!0,this.enemy.setCurrent(!1))}}const o=function(){const e=document.querySelector(".board-one"),t=document.querySelector(".board-two"),o=document.querySelector(".placing-board"),n=document.querySelector(".rotate-btn");let s=[],i="x";n.addEventListener("click",(e=>{i="y"===i?"x":"y"}));for(let o=0;o<10;o++)for(let r=0;r<10;r++){const n=document.createElement("div");n.classList.add("board-item"),n.dataset.coord=[r,o].join(""),e.appendChild(n),t.appendChild(n.cloneNode())}const a=function(e,t){!function(e){o.innerHTML="";for(let e=0;e<10;e++)for(let t=0;t<10;t++){const r=document.createElement("div");r.classList.add("board-item","invalid-placement"),r.dataset.coord=[t,e].join(""),o.appendChild(r)}e.myBoard.legalPlacements.forEach((([e,t])=>{document.querySelector(`.placing-board > [data-coord="${e}${t}"`).classList.remove("invalid-placement")})),e.myBoard.ships.forEach((e=>{e.coords.forEach((([e,t])=>{const o=document.querySelector(`.placing-board > [data-coord="${e}${t}"`);o.classList.remove("invalid-placement"),o.classList.add("ship")}))}))}(e);const r=document.querySelectorAll(".placing-board > .board-item"),n=document.querySelector(".card-text"),s=e.myBoard.types[t];n.textContent=`Place your ${s.type}`,r.forEach((o=>{o.addEventListener("mouseover",c.bind(null,o,s,e)),o.addEventListener("mouseout",l),o.addEventListener("click",d.bind(null,e,s,t))}))},c=function(e,t,o){const[r,n]=e.dataset.coord.split("").map(Number);let a=[];if("y"===i)for(let e=r;e<r+t.len;e++)a.push([e,n]);else for(let e=n;e<n+t.len;e++)a.push([r,e]);if(o.myBoard.canPlaceShip(a))a.forEach((([e,t])=>{document.querySelector(`.placing-board > [data-coord="${[e,t].join("")}"]`).classList.add("hover")})),s=a;else{let[e,t]=a[0];document.querySelector(`.placing-board > [data-coord="${[e,t].join("")}"]`).classList.add("invalid-hover"),s=[]}},l=function(e){document.querySelectorAll(".hover").forEach((e=>e.classList.remove("hover"))),document.querySelectorAll(".invalid-hover").forEach((e=>e.classList.remove("invalid-hover")))},d=function(e,t,o){e.myBoard.canPlaceShip(s)&&(e.myBoard.placeShip({coords:s,axis:i}),"Patrol Boat"===t.type?(document.querySelector(".overlay").remove(),r.gameLoop()):a(e,o+1))},u=function(e){let t;"player"===e.id?(t="one",e.myBoard.ships.forEach((e=>{e.coords.forEach((e=>{document.querySelector(`.board-${t} > [data-coord="${e.join("")}"]`).classList.add("ship")}))}))):t="two",e.myBoard.missed.forEach((e=>{document.querySelector(`.board-${t} > [data-coord="${e.join("")}"]`).classList.add("missed")})),e.myBoard.ships.forEach((e=>{e.hit.forEach((e=>{document.querySelector(`.board-${t} > [data-coord="${e.join("")}"]`).classList.add("hit")}))}))};return{render:function(e,t){u(e),u(t)},renderPlacingBoard:function(e){a(e,0)}}}(),r=function(){const e=new t,r=new t("comp"),n=function(){o.render(e,r),!0!==e.currentTurn?s():r.myBoard.legalMoves.forEach((e=>{document.querySelector(`.board-two > [data-coord="${e.join("")}"]`).addEventListener("click",s)}))},s=function(t="null"){if(!0===e.currentTurn){let[o,r]=t.target.dataset.coord.split("").map(Number);e.attack(o,r)}else r.compAttack();n()};return{initialize:function(){e.setEnemy(r),r.setEnemy(e),e.setCurrent(!0),r.compShips(),o.renderPlacingBoard(e)},gameLoop:n}}();r.initialize()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFdBQ2QsTUFBTXhDLEVBQVMsSUFBSXpDLEVBQ2J5RixFQUFXLElBQUl6RixFQUFPLFFBY3RCa0YsRUFBVyxXQUNmbEMsRUFBV3NDLE9BQU83QyxFQUFRZ0QsSUFFQyxJQUF2QmhELEVBQU9GLFlBU1htRCxJQVJFRCxFQUFTdEYsUUFBUUMsV0FBV1UsU0FBUzZFLElBQ25DekMsU0FDR0MsY0FBYyw2QkFBNkJ3QyxFQUFVN0IsS0FBSyxTQUMxRE4saUJBQWlCLFFBQVNrQyxFQUFhLEdBTWhELEVBRU1BLEVBQWUsU0FBVWpDLEVBQUksUUFDakMsSUFBMkIsSUFBdkJoQixFQUFPRixZQUFzQixDQUMvQixJQUFLakMsRUFBR0MsR0FBS2tELEVBQUVtQyxPQUFPL0IsUUFBUXhFLE1BQU15RixNQUFNLElBQUlDLElBQUlDLFFBQ2xEdkMsRUFBT0csT0FBT3RDLEVBQUdDLEVBQ25CLE1BQ0VrRixFQUFTMUMsYUFFWG1DLEdBQ0YsRUFJQSxNQUFPLENBQ0xXLFdBeENpQixXQUNqQnBELEVBQU9ELFNBQVNpRCxHQUNoQkEsRUFBU2pELFNBQVNDLEdBQ2xCQSxFQUFPQyxZQUFXLEdBS2xCK0MsRUFBUzNDLFlBQ1RFLEVBQVd3QyxtQkFBbUIvQyxFQUpoQyxFQW9DRXlDLFdBRUgsQ0EvQ2UsR0NEaEJELEVBQVFZLFkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvU2hpcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL21vZHVsZXMvUGxheWVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvbW9kdWxlcy9HYW1lQm9hcmQuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL3JlbmRlckdhbWUuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9tb2R1bGVzL3J1bkdhbWUuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBTaGlwID0gZnVuY3Rpb24gKGluZm8pIHtcbiAgcmV0dXJuIHtcbiAgICBpbmZvLFxuICAgIGNvb3JkczogaW5mby5jb29yZHMsXG4gICAgaGl0OiBbXSxcbiAgICBwcm9jZXNzSGl0OiBmdW5jdGlvbiAoY29vcmQpIHtcbiAgICAgIHRoaXMuaGl0LnB1c2goY29vcmQpO1xuICAgIH0sXG4gICAgaXNTdW5rOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5oaXQubGVuZ3RoID09PSB0aGlzLmNvb3Jkcy5sZW5ndGggPyB0cnVlIDogZmFsc2U7XG4gICAgfSxcbiAgICBjb250YWluczogZnVuY3Rpb24gKGNvb3JkLCBvYmopIHtcbiAgICAgIHJldHVybiB0aGlzW29ial0uc29tZShcbiAgICAgICAgKGl0ZW0pID0+IEpTT04uc3RyaW5naWZ5KGl0ZW0pID09PSBKU09OLnN0cmluZ2lmeShjb29yZClcbiAgICAgICk7XG4gICAgfSxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IFNoaXAgfTtcbiIsImltcG9ydCB7IEdhbWVCb2FyZCB9IGZyb20gXCIuL0dhbWVCb2FyZFwiO1xuXG5jbGFzcyBQbGF5ZXIge1xuICBjb25zdHJ1Y3RvcihpZCA9IFwicGxheWVyXCIpIHtcbiAgICB0aGlzLm15Qm9hcmQgPSBHYW1lQm9hcmQoKTtcbiAgICB0aGlzLmVuZW15O1xuICAgIHRoaXMuaWQgPSBpZDtcbiAgICB0aGlzLmN1cnJlbnRUdXJuID0gZmFsc2U7XG4gIH1cblxuICBzZXRFbmVteShwbGF5ZXIpIHtcbiAgICB0aGlzLmVuZW15ID0gcGxheWVyO1xuICB9XG5cbiAgc2V0Q3VycmVudCh0dXJuKSB7XG4gICAgdGhpcy5jdXJyZW50VHVybiA9IHR1cm47XG4gIH1cblxuICBhdHRhY2soeCwgeSkge1xuICAgIHJldHVybiB0aGlzLmVuZW15LnJlY2VpdmUoeCwgeSk7XG4gIH1cblxuICBjb21wU2hpcHMoKSB7XG4gICAgaWYgKHRoaXMuaWQgIT09IFwiY29tcFwiKSByZXR1cm47XG4gICAgdGhpcy5teUJvYXJkLmF1dG9tYXRpY1NoaXBzKCk7XG4gIH1cblxuICBjb21wQXR0YWNrKCkge1xuICAgIGlmICh0aGlzLmlkICE9PSBcImNvbXBcIikgcmV0dXJuO1xuICAgIGxldCBsZWdhbE1vdmVzID0gdGhpcy5lbmVteS5teUJvYXJkLmxlZ2FsTW92ZXM7XG4gICAgbGV0IFt4LCB5XSA9IGxlZ2FsTW92ZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbGVnYWxNb3Zlcy5sZW5ndGgpXTtcbiAgICByZXR1cm4gdGhpcy5lbmVteS5yZWNlaXZlKHgsIHkpO1xuICB9XG5cbiAgcmVjZWl2ZSh4LCB5KSB7XG4gICAgaWYgKHRoaXMubXlCb2FyZC5pc0lsbGVnYWwoeCwgeSkpIHJldHVybiBcIklsbGVnYWwgTW92ZVwiO1xuICAgIGxldCBoaXQgPSB0aGlzLm15Qm9hcmQucmVjZWl2ZUF0dGFjayh4LCB5KTtcbiAgICBpZiAoaGl0ICE9PSB0cnVlKSB7XG4gICAgICB0aGlzLmN1cnJlbnRUdXJuID0gdHJ1ZTtcbiAgICAgIHRoaXMuZW5lbXkuc2V0Q3VycmVudChmYWxzZSk7XG4gICAgfVxuICAgIHJldHVybiBcbiAgfVxufVxuXG5leHBvcnQgeyBQbGF5ZXIgfTtcbiIsImltcG9ydCB7IFNoaXAgfSBmcm9tIFwiLi9TaGlwXCI7XG5cbmNvbnN0IEdhbWVCb2FyZCA9IGZ1bmN0aW9uICgpIHtcbiAgbGV0IGxlZ2FsTW92ZXMgPSBbXTtcbiAgbGV0IGxlZ2FsUGxhY2VtZW50cyA9IFtdO1xuICBmb3IgKGxldCB4ID0gMDsgeCA8IDEwOyB4KyspIHtcbiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IDEwOyB5KyspIHtcbiAgICAgIGxlZ2FsTW92ZXMucHVzaChbeCwgeV0pO1xuICAgICAgbGVnYWxQbGFjZW1lbnRzLnB1c2goW3gsIHldKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHNoaXBzOiBbXSxcbiAgICBtaXNzZWQ6IFtdLFxuICAgIHR5cGVzOiBbXG4gICAgICB7IHR5cGU6IFwiQ2FycmllclwiLCBsZW46IDUgfSxcbiAgICAgIHsgdHlwZTogXCJCYXR0bGVzaGlwXCIsIGxlbjogNCB9LFxuICAgICAgeyB0eXBlOiBcIkRlc3Ryb3llclwiLCBsZW46IDMgfSxcbiAgICAgIHsgdHlwZTogXCJTdWJtYXJpbmVcIiwgbGVuOiAzIH0sXG4gICAgICB7IHR5cGU6IFwiUGF0cm9sIEJvYXRcIiwgbGVuOiAyIH0sXG4gICAgXSxcbiAgICBsZWdhbFBsYWNlbWVudHMsXG4gICAgbGVnYWxNb3ZlcyxcblxuICAgIGF1dG9tYXRpY1NoaXBzOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnR5cGVzLmZvckVhY2goKHR5cGUpID0+IHtcbiAgICAgICAgY29uc3QgYXhpcyA9IFtcInhcIiwgXCJ5XCJdW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpXTtcbiAgICAgICAgbGV0IGNvb3JkcyA9IFtdO1xuICAgICAgICB3aGlsZSAoIXRoaXMuY2FuUGxhY2VTaGlwKGNvb3JkcykpIHtcbiAgICAgICAgICBjb29yZHMgPSBbXTtcbiAgICAgICAgICBsZXQgW3gsIHldID1cbiAgICAgICAgICAgIHRoaXMubGVnYWxQbGFjZW1lbnRzW1xuICAgICAgICAgICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLmxlZ2FsUGxhY2VtZW50cy5sZW5ndGgpXG4gICAgICAgICAgICBdO1xuICAgICAgICAgIGlmIChheGlzID09PSBcInhcIikge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IHk7IGkgPCB5ICsgdHlwZS5sZW47IGkrKykge1xuICAgICAgICAgICAgICBjb29yZHMucHVzaChbeCwgaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0geDsgaSA8IHggKyB0eXBlLmxlbjsgaSsrKSB7XG4gICAgICAgICAgICAgIGNvb3Jkcy5wdXNoKFtpLCB5XSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxldCBpbmZvID0ge1xuICAgICAgICAgIGNvb3JkcyxcbiAgICAgICAgICBheGlzLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLnNoaXBzLnB1c2goU2hpcChpbmZvKSk7XG4gICAgICAgIHRoaXMudXBkYXRlTGVnYWxQbGFjZW1lbnRzKGluZm8pO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIHBsYWNlU2hpcDogZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgIHRoaXMuc2hpcHMucHVzaChTaGlwKGluZm8pKTtcbiAgICAgIHRoaXMudXBkYXRlTGVnYWxQbGFjZW1lbnRzKGluZm8pO1xuICAgIH0sXG5cbiAgICBjYW5QbGFjZVNoaXA6IGZ1bmN0aW9uIChjb29yZHMpIHtcbiAgICAgIGlmIChjb29yZHMubGVuZ3RoIDwgMikgcmV0dXJuIGZhbHNlO1xuICAgICAgcmV0dXJuIGNvb3Jkcy5ldmVyeSgoY29vcmQpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGVnYWxQbGFjZW1lbnRzLnNvbWUoKGxlZ2FsUGxhY2UpID0+IHtcbiAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoY29vcmQpID09PSBKU09OLnN0cmluZ2lmeShsZWdhbFBsYWNlKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgdXBkYXRlTGVnYWxQbGFjZW1lbnRzOiBmdW5jdGlvbiAoaW5mbykge1xuICAgICAgbGV0IGxpc3QgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGluZm8uY29vcmRzKSk7XG4gICAgICBsZXQgW2EsIGJdID0gaW5mby5jb29yZHNbMF07XG4gICAgICBsZXQgW3ksIHpdID0gaW5mby5jb29yZHNbaW5mby5jb29yZHMubGVuZ3RoIC0gMV07XG5cbiAgICAgIGlmIChpbmZvLmF4aXMgPT09IFwieVwiKSB7XG4gICAgICAgIGxpc3QucHVzaChbYSAtIDEsIGJdLCBbeSArIDEsIHpdKTtcbiAgICAgICAgbGlzdC5mb3JFYWNoKChbeCwgeV0pID0+IHtcbiAgICAgICAgICBsaXN0LnB1c2goW3gsIHkgLSAxXSwgW3gsIHkgKyAxXSk7XG4gICAgICAgIH0pO1xuICAgICAgICBpbmZvLmNvb3Jkcy5mb3JFYWNoKChbeCwgeV0pID0+IHtcbiAgICAgICAgICBsaXN0LnB1c2goW3gsIHkgLSAxXSwgW3gsIHkgKyAxXSk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGlzdC5wdXNoKFthLCBiIC0gMV0sIFt5LCB6ICsgMV0pO1xuICAgICAgICBsaXN0LmZvckVhY2goKFt4LCB5XSkgPT4ge1xuICAgICAgICAgIGxpc3QucHVzaChbeCAtIDEsIHldLCBbeCArIDEsIHldKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGluZm8uY29vcmRzLmZvckVhY2goKFt4LCB5XSkgPT4ge1xuICAgICAgICAgIGxpc3QucHVzaChbeCAtIDEsIHldLCBbeCArIDEsIHldKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGxldCBhcnIgPSB0aGlzLmxlZ2FsUGxhY2VtZW50cy5maWx0ZXIoKGNvb3JkKSA9PiB7XG4gICAgICAgIHJldHVybiBsaXN0LmV2ZXJ5KFxuICAgICAgICAgIChpdGVtKSA9PiBKU09OLnN0cmluZ2lmeShjb29yZCkgIT09IEpTT04uc3RyaW5naWZ5KGl0ZW0pXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5sZWdhbFBsYWNlbWVudHMgPSBhcnI7XG4gICAgfSxcblxuICAgIHJlY2VpdmVBdHRhY2s6IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICBsZXQgaGl0ID0gZmFsc2U7XG4gICAgICB0aGlzLnNoaXBzLmV2ZXJ5KChzaGlwKSA9PiB7XG4gICAgICAgIGlmIChzaGlwLmNvbnRhaW5zKFt4LCB5XSwgXCJjb29yZHNcIikpIHtcbiAgICAgICAgICBzaGlwLnByb2Nlc3NIaXQoW3gsIHldKTtcbiAgICAgICAgICBoaXQgPSB0cnVlO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoaGl0ID09PSBmYWxzZSkgdGhpcy5taXNzZWQucHVzaChbeCwgeV0pO1xuICAgICAgdGhpcy51cGRhdGVMZWdhbCh4LCB5KTtcbiAgICAgIHJldHVybiBoaXQ7XG4gICAgfSxcblxuICAgIGFsbFN1bms6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnNoaXBzLmV2ZXJ5KChzaGlwKSA9PiB7XG4gICAgICAgIHJldHVybiBzaGlwLmlzU3VuaygpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIHVwZGF0ZUxlZ2FsOiBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgbGV0IGFyciA9IHRoaXMubGVnYWxNb3Zlcy5maWx0ZXIoXG4gICAgICAgIChjb29yZCkgPT4gSlNPTi5zdHJpbmdpZnkoY29vcmQpICE9PSBKU09OLnN0cmluZ2lmeShbeCwgeV0pXG4gICAgICApO1xuXG4gICAgICB0aGlzLmxlZ2FsTW92ZXMgPSBhcnI7XG4gICAgfSxcblxuICAgIGlzSWxsZWdhbDogZnVuY3Rpb24gKHgsIHkpIHtcbiAgICAgIHJldHVybiB0aGlzLmxlZ2FsTW92ZXMuZXZlcnkoKGNvb3JkKSA9PiB7XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShjb29yZCkgIT09IEpTT04uc3RyaW5naWZ5KFt4LCB5XSk7XG4gICAgICB9KTtcbiAgICB9LFxuICB9O1xufTtcblxuZXhwb3J0IHsgR2FtZUJvYXJkIH07XG4iLCJpbXBvcnQgeyBydW5HYW1lIH0gZnJvbSBcIi4vcnVuR2FtZVwiO1xuXG5jb25zdCByZW5kZXJHYW1lID0gKGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgYm9hcmRPbmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJvYXJkLW9uZVwiKTtcbiAgY29uc3QgYm9hcmRUd28gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJvYXJkLXR3b1wiKTtcbiAgY29uc3QgcGxhY2luZ0JvYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGFjaW5nLWJvYXJkXCIpO1xuICBjb25zdCByb3RhdGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJvdGF0ZS1idG5cIik7XG4gIGxldCBmcmVzaENvb3JkcyA9IFtdO1xuXG4gIGxldCBheGlzID0gXCJ4XCI7XG4gIHJvdGF0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICBheGlzID09PSBcInlcIiA/IChheGlzID0gXCJ4XCIpIDogKGF4aXMgPSBcInlcIik7XG4gIH0pO1xuXG4gIGZvciAobGV0IHggPSAwOyB4IDwgMTA7IHgrKykge1xuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgMTA7IHkrKykge1xuICAgICAgY29uc3QgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoXCJib2FyZC1pdGVtXCIpO1xuICAgICAgaXRlbS5kYXRhc2V0LmNvb3JkID0gW3ksIHhdLmpvaW4oXCJcIik7XG4gICAgICBib2FyZE9uZS5hcHBlbmRDaGlsZChpdGVtKTtcbiAgICAgIGJvYXJkVHdvLmFwcGVuZENoaWxkKGl0ZW0uY2xvbmVOb2RlKCkpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGxvYWRQbGFjaW5nQm9hcmQgPSBmdW5jdGlvbiAocDEpIHtcbiAgICBwbGFjaW5nQm9hcmQuaW5uZXJIVE1MID0gXCJcIjtcbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IDEwOyB4KyspIHtcbiAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgMTA7IHkrKykge1xuICAgICAgICBjb25zdCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKFwiYm9hcmQtaXRlbVwiLCBcImludmFsaWQtcGxhY2VtZW50XCIpO1xuICAgICAgICBpdGVtLmRhdGFzZXQuY29vcmQgPSBbeSwgeF0uam9pbihcIlwiKTtcbiAgICAgICAgcGxhY2luZ0JvYXJkLmFwcGVuZENoaWxkKGl0ZW0pO1xuICAgICAgfVxuICAgIH1cbiAgICBwMS5teUJvYXJkLmxlZ2FsUGxhY2VtZW50cy5mb3JFYWNoKChbeCwgeV0pID0+IHtcbiAgICAgIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBgLnBsYWNpbmctYm9hcmQgPiBbZGF0YS1jb29yZD1cIiR7eH0ke3l9XCJgXG4gICAgICApO1xuICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKFwiaW52YWxpZC1wbGFjZW1lbnRcIik7XG4gICAgfSk7XG5cbiAgICBwMS5teUJvYXJkLnNoaXBzLmZvckVhY2goKHNoaXApID0+IHtcbiAgICAgIHNoaXAuY29vcmRzLmZvckVhY2goKFt4LCB5XSkgPT4ge1xuICAgICAgICBjb25zdCBpdGVtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICBgLnBsYWNpbmctYm9hcmQgPiBbZGF0YS1jb29yZD1cIiR7eH0ke3l9XCJgXG4gICAgICAgICk7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZShcImludmFsaWQtcGxhY2VtZW50XCIpO1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoXCJzaGlwXCIpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgcmVuZGVyUGxhY2luZ0JvYXJkID0gZnVuY3Rpb24gKHAxKSB7XG4gICAgcGxhY2VTaGlwKHAxLCAwKTtcbiAgfTtcblxuICBjb25zdCBwbGFjZVNoaXAgPSBmdW5jdGlvbiAocDEsIGluZGV4KSB7XG4gICAgbG9hZFBsYWNpbmdCb2FyZChwMSk7XG4gICAgY29uc3QgYm9hcmRJdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICBcIi5wbGFjaW5nLWJvYXJkID4gLmJvYXJkLWl0ZW1cIlxuICAgICk7XG4gICAgY29uc3QgY2FyZFRleHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmQtdGV4dFwiKTtcbiAgICBjb25zdCB0eXBlID0gcDEubXlCb2FyZC50eXBlc1tpbmRleF07XG4gICAgY2FyZFRleHQudGV4dENvbnRlbnQgPSBgUGxhY2UgeW91ciAke3R5cGUudHlwZX1gO1xuXG4gICAgYm9hcmRJdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgIFwibW91c2VvdmVyXCIsXG4gICAgICAgIGhhbmRsZU1vdXNlT3Zlci5iaW5kKG51bGwsIGl0ZW0sIHR5cGUsIHAxKVxuICAgICAgKTtcbiAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIGhhbmRsZU1vdXNlT3V0KTtcbiAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZUNsaWNrLmJpbmQobnVsbCwgcDEsIHR5cGUsIGluZGV4KSk7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3QgaGFuZGxlTW91c2VPdmVyID0gZnVuY3Rpb24gKGl0ZW0sIHR5cGUsIHAxKSB7XG4gICAgY29uc3QgW3gsIHldID0gaXRlbS5kYXRhc2V0LmNvb3JkLnNwbGl0KFwiXCIpLm1hcChOdW1iZXIpO1xuICAgIGxldCBjb29yZHMgPSBbXTtcbiAgICBpZiAoYXhpcyA9PT0gXCJ5XCIpIHtcbiAgICAgIGZvciAobGV0IGkgPSB4OyBpIDwgeCArIHR5cGUubGVuOyBpKyspIHtcbiAgICAgICAgY29vcmRzLnB1c2goW2ksIHldKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChsZXQgaSA9IHk7IGkgPCB5ICsgdHlwZS5sZW47IGkrKykge1xuICAgICAgICBjb29yZHMucHVzaChbeCwgaV0pO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocDEubXlCb2FyZC5jYW5QbGFjZVNoaXAoY29vcmRzKSkge1xuICAgICAgY29vcmRzLmZvckVhY2goKFtpLCB5XSkgPT4ge1xuICAgICAgICBkb2N1bWVudFxuICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKGAucGxhY2luZy1ib2FyZCA+IFtkYXRhLWNvb3JkPVwiJHtbaSwgeV0uam9pbihcIlwiKX1cIl1gKVxuICAgICAgICAgIC5jbGFzc0xpc3QuYWRkKFwiaG92ZXJcIik7XG4gICAgICB9KTtcbiAgICAgIGZyZXNoQ29vcmRzID0gY29vcmRzO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgW3gsIHldID0gY29vcmRzWzBdO1xuICAgICAgZG9jdW1lbnRcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoYC5wbGFjaW5nLWJvYXJkID4gW2RhdGEtY29vcmQ9XCIke1t4LCB5XS5qb2luKFwiXCIpfVwiXWApXG4gICAgICAgIC5jbGFzc0xpc3QuYWRkKFwiaW52YWxpZC1ob3ZlclwiKTtcbiAgICAgIGZyZXNoQ29vcmRzID0gW107XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGhhbmRsZU1vdXNlT3V0ID0gZnVuY3Rpb24gKGUpIHtcbiAgICBkb2N1bWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuaG92ZXJcIilcbiAgICAgIC5mb3JFYWNoKChpdGVtKSA9PiBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoXCJob3ZlclwiKSk7XG4gICAgZG9jdW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKFwiLmludmFsaWQtaG92ZXJcIilcbiAgICAgIC5mb3JFYWNoKChpdGVtKSA9PiBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoXCJpbnZhbGlkLWhvdmVyXCIpKTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVDbGljayA9IGZ1bmN0aW9uIChwMSwgdHlwZSwgaW5kZXgpIHtcbiAgICBpZiAoIXAxLm15Qm9hcmQuY2FuUGxhY2VTaGlwKGZyZXNoQ29vcmRzKSkgcmV0dXJuO1xuXG4gICAgcDEubXlCb2FyZC5wbGFjZVNoaXAoe1xuICAgICAgY29vcmRzOiBmcmVzaENvb3JkcyxcbiAgICAgIGF4aXMsXG4gICAgfSk7XG5cbiAgICBpZiAodHlwZS50eXBlID09PSBcIlBhdHJvbCBCb2F0XCIpIHtcbiAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIub3ZlcmxheVwiKS5yZW1vdmUoKTtcbiAgICAgIHJ1bkdhbWUuZ2FtZUxvb3AoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcGxhY2VTaGlwKHAxLCBpbmRleCArIDEpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCByZW5kZXIgPSBmdW5jdGlvbiAocDEsIHAyKSB7XG4gICAgcmVuZGVyUGxheWVyKHAxKTtcbiAgICByZW5kZXJQbGF5ZXIocDIpO1xuICB9O1xuXG4gIGNvbnN0IHJlbmRlclBsYXllciA9IGZ1bmN0aW9uIChwbGF5ZXIpIHtcbiAgICBsZXQgbnVtO1xuICAgIGlmIChwbGF5ZXIuaWQgPT09IFwicGxheWVyXCIpIHtcbiAgICAgIG51bSA9IFwib25lXCI7XG4gICAgICBwbGF5ZXIubXlCb2FyZC5zaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgICAgIHNoaXAuY29vcmRzLmZvckVhY2goKGNvb3JkKSA9PiB7XG4gICAgICAgICAgZG9jdW1lbnRcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKGAuYm9hcmQtJHtudW19ID4gW2RhdGEtY29vcmQ9XCIke2Nvb3JkLmpvaW4oXCJcIil9XCJdYClcbiAgICAgICAgICAgIC5jbGFzc0xpc3QuYWRkKFwic2hpcFwiKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgbnVtID0gXCJ0d29cIjtcbiAgICB9XG5cbiAgICBwbGF5ZXIubXlCb2FyZC5taXNzZWQuZm9yRWFjaCgobWlzcykgPT4ge1xuICAgICAgZG9jdW1lbnRcbiAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoYC5ib2FyZC0ke251bX0gPiBbZGF0YS1jb29yZD1cIiR7bWlzcy5qb2luKFwiXCIpfVwiXWApXG4gICAgICAgIC5jbGFzc0xpc3QuYWRkKFwibWlzc2VkXCIpO1xuICAgIH0pO1xuXG4gICAgcGxheWVyLm15Qm9hcmQuc2hpcHMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgICAgc2hpcC5oaXQuZm9yRWFjaCgoaGl0KSA9PiB7XG4gICAgICAgIGRvY3VtZW50XG4gICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoYC5ib2FyZC0ke251bX0gPiBbZGF0YS1jb29yZD1cIiR7aGl0LmpvaW4oXCJcIil9XCJdYClcbiAgICAgICAgICAuY2xhc3NMaXN0LmFkZChcImhpdFwiKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcmVuZGVyLFxuICAgIHJlbmRlclBsYWNpbmdCb2FyZCxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCB7IHJlbmRlckdhbWUgfTtcbiIsImltcG9ydCB7IFBsYXllciB9IGZyb20gXCIuL1BsYXllclwiO1xuaW1wb3J0IHsgcmVuZGVyR2FtZSB9IGZyb20gXCIuL3JlbmRlckdhbWVcIjtcblxuY29uc3QgcnVuR2FtZSA9IChmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IHBsYXllciA9IG5ldyBQbGF5ZXIoKTtcbiAgY29uc3QgY29tcHV0ZXIgPSBuZXcgUGxheWVyKFwiY29tcFwiKTtcblxuICBjb25zdCBpbml0aWFsaXplID0gZnVuY3Rpb24gKCkge1xuICAgIHBsYXllci5zZXRFbmVteShjb21wdXRlcik7XG4gICAgY29tcHV0ZXIuc2V0RW5lbXkocGxheWVyKTtcbiAgICBwbGF5ZXIuc2V0Q3VycmVudCh0cnVlKTtcbiAgICBwbGFjZVNoaXBzKCk7XG4gIH07XG5cbiAgY29uc3QgcGxhY2VTaGlwcyA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb21wdXRlci5jb21wU2hpcHMoKTtcbiAgICByZW5kZXJHYW1lLnJlbmRlclBsYWNpbmdCb2FyZChwbGF5ZXIpO1xuICB9O1xuXG4gIGNvbnN0IGdhbWVMb29wID0gZnVuY3Rpb24gKCkge1xuICAgIHJlbmRlckdhbWUucmVuZGVyKHBsYXllciwgY29tcHV0ZXIpO1xuXG4gICAgaWYgKHBsYXllci5jdXJyZW50VHVybiA9PT0gdHJ1ZSkge1xuICAgICAgY29tcHV0ZXIubXlCb2FyZC5sZWdhbE1vdmVzLmZvckVhY2goKGxlZ2FsTW92ZSkgPT4ge1xuICAgICAgICBkb2N1bWVudFxuICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKGAuYm9hcmQtdHdvID4gW2RhdGEtY29vcmQ9XCIke2xlZ2FsTW92ZS5qb2luKFwiXCIpfVwiXWApXG4gICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwcm9jZXNzQ2xpY2spO1xuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcHJvY2Vzc0NsaWNrKCk7XG4gIH07XG5cbiAgY29uc3QgcHJvY2Vzc0NsaWNrID0gZnVuY3Rpb24gKGUgPSBcIm51bGxcIikge1xuICAgIGlmIChwbGF5ZXIuY3VycmVudFR1cm4gPT09IHRydWUpIHtcbiAgICAgIGxldCBbeCwgeV0gPSBlLnRhcmdldC5kYXRhc2V0LmNvb3JkLnNwbGl0KFwiXCIpLm1hcChOdW1iZXIpO1xuICAgICAgcGxheWVyLmF0dGFjayh4LCB5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29tcHV0ZXIuY29tcEF0dGFjaygpO1xuICAgIH1cbiAgICBnYW1lTG9vcCgpO1xuICB9O1xuXG4gIGNvbnN0IGVuZEdhbWUgPSBmdW5jdGlvbiAoKSB7fTtcblxuICByZXR1cm4ge1xuICAgIGluaXRpYWxpemUsXG4gICAgZ2FtZUxvb3AsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgeyBydW5HYW1lIH07XG4iLCJpbXBvcnQgeyBydW5HYW1lIH0gZnJvbSBcIi4vbW9kdWxlcy9ydW5HYW1lXCI7XG5cbnJ1bkdhbWUuaW5pdGlhbGl6ZSgpOyJdLCJuYW1lcyI6WyJTaGlwIiwiaW5mbyIsImNvb3JkcyIsImhpdCIsInByb2Nlc3NIaXQiLCJjb29yZCIsInRoaXMiLCJwdXNoIiwiaXNTdW5rIiwibGVuZ3RoIiwiY29udGFpbnMiLCJvYmoiLCJzb21lIiwiaXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJQbGF5ZXIiLCJjb25zdHJ1Y3RvciIsImlkIiwibXlCb2FyZCIsImxlZ2FsTW92ZXMiLCJsZWdhbFBsYWNlbWVudHMiLCJ4IiwieSIsInNoaXBzIiwibWlzc2VkIiwidHlwZXMiLCJ0eXBlIiwibGVuIiwiYXV0b21hdGljU2hpcHMiLCJmb3JFYWNoIiwiYXhpcyIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImNhblBsYWNlU2hpcCIsImkiLCJ1cGRhdGVMZWdhbFBsYWNlbWVudHMiLCJwbGFjZVNoaXAiLCJldmVyeSIsImxlZ2FsUGxhY2UiLCJsaXN0IiwicGFyc2UiLCJhIiwiYiIsInoiLCJhcnIiLCJmaWx0ZXIiLCJyZWNlaXZlQXR0YWNrIiwic2hpcCIsInVwZGF0ZUxlZ2FsIiwiYWxsU3VuayIsImlzSWxsZWdhbCIsIkdhbWVCb2FyZCIsImVuZW15IiwiY3VycmVudFR1cm4iLCJzZXRFbmVteSIsInBsYXllciIsInNldEN1cnJlbnQiLCJ0dXJuIiwiYXR0YWNrIiwicmVjZWl2ZSIsImNvbXBTaGlwcyIsImNvbXBBdHRhY2siLCJyZW5kZXJHYW1lIiwiYm9hcmRPbmUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJib2FyZFR3byIsInBsYWNpbmdCb2FyZCIsInJvdGF0ZUJ0biIsImZyZXNoQ29vcmRzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiZGF0YXNldCIsImpvaW4iLCJhcHBlbmRDaGlsZCIsImNsb25lTm9kZSIsInAxIiwiaW5kZXgiLCJpbm5lckhUTUwiLCJyZW1vdmUiLCJsb2FkUGxhY2luZ0JvYXJkIiwiYm9hcmRJdGVtcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJjYXJkVGV4dCIsInRleHRDb250ZW50IiwiaGFuZGxlTW91c2VPdmVyIiwiYmluZCIsImhhbmRsZU1vdXNlT3V0IiwiaGFuZGxlQ2xpY2siLCJzcGxpdCIsIm1hcCIsIk51bWJlciIsInJ1bkdhbWUiLCJnYW1lTG9vcCIsInJlbmRlclBsYXllciIsIm51bSIsIm1pc3MiLCJyZW5kZXIiLCJwMiIsInJlbmRlclBsYWNpbmdCb2FyZCIsImNvbXB1dGVyIiwicHJvY2Vzc0NsaWNrIiwibGVnYWxNb3ZlIiwidGFyZ2V0IiwiaW5pdGlhbGl6ZSJdLCJzb3VyY2VSb290IjoiIn0=